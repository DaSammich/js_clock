<!DOCTYPE html>
<html>
<head>
<script
	src="https://code.jquery.com/jquery-3.2.1.min.js"
	integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4="
	crossorigin="anonymous">
</script>
</head>
<body>


enter your minutes: <input id='text_input' type='text'> <button id="set">Set</button>
<br>
<span id='date'>00d 00h 00m 00s</span>
<br>
<button id="pause">pause</button>
<button id="plus">+</button>
<button id="minus">-</button>






</body>


<script>

// Note: always clear interval before starting a new one in start_timer()

// initialize the globals within this object context scope
var old = new Date();		
var on = true;					// paused or not?
var total = 0;					// keep track of the total time elasped
var interval;						// need global access to clear anywhere within this timer
var ms_left = null;			// constant final goal time to meet in ms
var inc = 0;						// auxilary total for + / - function
var fake_inc = 0;				// auxilary total for display + / - during pause state
var last_distance;  		// keep track of last distance (aka time) for pause state


function min_to_ms(mins) {
	return mins * 60 * 1000;
}

function pause() {
	// check if initialized - can't pause/unpause if it's not
	if (!(ms_left === null)) {
		if (on) {
			on = false;
			// save the cummulative passed time
			total += new Date().getTime() - old;
			clearInterval(interval);
			$("#pause").html("resume");
		} 
		else {
			unpause();
		}
	}
}

function unpause(interval) {
	if (!on) {
		// start over and add in the cumulative time
		old = new Date();
		clearInterval(interval);
		start_timer();
		on = true;
		$("#pause").html("pause");
	}
}

function add_zero(unit) {
	return unit.toString().length < 2 ?
		'0' + unit.toString() : 
		unit;
}

// initialize your timer 
function init() {
	// competely reset globals
	old = new Date();
	total = 0;
	inc = 0;
	
	// if it's paused, we want to display initial time
	if (!on) {
		var sec = Math.floor(ms_left/1000 % 60);
		var min = Math.floor(ms_left / 1000 / 60 % 60);
		var hrs = Math.floor(ms_left / 1000 / 60 / 60 % 24);
		var days = Math.floor(ms_left / 1000 / 60 / 60 / 24);
		$("#date").html(add_zero(days) + 'd ' + add_zero(hrs) +'h ' + add_zero(min) + 'm ' + add_zero(sec) + 's ');
	} else {
		// make sure to clear interval before starting a new one
		clearInterval(interval);
		start_timer();
	}
}

// the timer object / function
// only displays when the timer is set to "on"
// creates a new js interval
function start_timer() {
	
	interval = setInterval(function() {
		
	// count the cummulative seconds in ms
	var moving = new Date().getTime();
	last_moving = moving;							// keep track of last position for pause
	distance = moving - old + total;
	distance = ms_left - distance - inc;
	last_distance = distance;					// track the distance for pause display
	
	// end the timer once it hits 0 *TODO
		
	var sec = Math.floor(distance/1000 % 60);
	var min = Math.floor(distance / 1000 / 60 % 60)
	var hrs = Math.floor(distance / 1000 / 60 / 60 % 24);
	var days = Math.floor(distance / 1000 / 60 / 60 / 24);
	last_distance = distance
	
	// Can't use update_display() here because we need to check for 'on'
	// Also check for negative number
	if (on) {
		document.getElementById('date').innerHTML = add_zero(days) + 'd ' + add_zero(hrs) +'h ' + add_zero(min) + 'm ' + add_zero(sec) + 's ';
	}
	console.log(interval);
	
	// reset the fake inc for the pause state to display correctly
	fake_inc = 0
	
	}, 250);
}

// updates the display with most current time on call
// displays whether it is paused or not
function update_display() {
	if (on) {
		var sec = Math.floor(last_distance/1000 % 60);
		var min = Math.floor(last_distance / 1000 / 60 % 60);
		var hrs = Math.floor(last_distance / 1000 / 60 / 60 % 24);
		var days = Math.floor(last_distance / 1000 / 60 / 60 / 24);
		
		$("#date").html(add_zero(days) + 'd ' + add_zero(hrs) +'h ' + add_zero(min) + 'm ' + add_zero(sec) + 's ');
	} 
	// if the timer is paused we need new logic
	else {
		// inc is global, it will accumulate - use fake_inc instead for pause state
		
		fake_last_distance = last_distance - fake_inc;
		
		var sec = Math.floor(fake_last_distance/1000 % 60);
		var min = Math.floor(fake_last_distance / 1000 / 60 % 60);
		var hrs = Math.floor(fake_last_distance / 1000 / 60 / 60 % 24);
		var days = Math.floor(fake_last_distance / 1000 / 60 / 60 / 24);
		
		$("#date").html(add_zero(days) + 'd ' + add_zero(hrs) +'h ' + add_zero(min) + 'm ' + add_zero(sec) + 's ');
	}
}

function plus() {
	// add 60 seconds converted from ms
	inc -= 1000;
	// reset the fake inc during the timer 
	if (!on) {
		fake_inc -= 1000;
	} 
	update_display();
}


function minus() {
	// subtract 60 seconds converted from ms
	inc += 1000;
	
	// we must reset the fake inc during the timer
	if (!on) {
		fake_inc += 1000;
	} 
	update_display(); 
}


function start_with_mins_left() {
	ms_left = $("#text_input").val();
	ms_left = min_to_ms(ms_left);
	if (ms_left > 0) { init(); }
}

$(document).ready(function() {
	
	$("#plus").click(plus);
	$("#minus").click(minus);
	$("#pause").click(pause);
	
	// the actual event handlers for timer
	$("#set").click(start_with_mins_left)
	$("#text_input").on("keyup", function(e) {
		if (e.keyCode == '13') {
			start_with_mins_left();
		}
	})

})



</script>



</html>
